"use strict";YUI.add("rg-dropdown-plugin",function(a){a.namespace("rg.plugin"),a.rg.plugin.DropdownPlugin=a.Base.create("DropdownPlugin",a.Plugin.Base,[],{activator:null,menu:null,event:null,initializer:function(){var a=this.get("host");this.activator=a.all(this.get("activatorSelector")),this.menu=a.one(this.get("menuSelector")),this.event=this.activator.on("click",this._onToggle,this)},destructor:function(){this.get("host").removeClass(this.get("openClass")),this.event.detach()},_onToggle:function(a){var b=this.get("host"),c=a.target;this.get("ignoreToggle")||c.hasClass("js-ignore-dropdown-toggle")||this.get("ignoreInsideClick")&&c.ancestor(this.get("menuSelector"))&&!c.hasClass(this.get("closeDropdownClass"))||(this.event.detach(),b.hasClass(this.get("openClass"))?this._closeDropdown(a):this._openDropdown(a))},_openDropdown:function(b){this.get("ignoreLinks")&&b.preventDefault(),a.Lang.later(10,this,function(){this.event=a.one("document").on("click",this._onToggle,this),this.get("callbackOnOpen")&&this.get("callbackOnOpen").apply(this.get("callbackContext"),[this,b])});var c=this.get("host"),d=this.get("openClass");c.toggleClass(d)},_closeDropdown:function(a){this.get("ignoreLinks")&&a.preventDefault(),this.event=this.activator.on("click",this._onToggle,this),this.get("callbackOnClose")&&this.get("callbackOnClose").apply(this.get("callbackContext"),[this,a]);var b=this.get("host"),c=this.get("openClass");b.toggleClass(c)}},{NS:"dropdownPlugin",ATTRS:{activatorSelector:{value:".dropdown-toggle"},menuSelector:{value:".dropdown-menu"},openClass:{value:"dropdown-open"},ignoreInsideClick:{value:!1},callbackOnOpen:{value:null},callbackOnClose:{value:null},callbackContext:{value:this},closeDropdownClass:{value:"js-close-dropdown"},ignoreToggle:{value:!1},ignoreLinks:{value:!1}}})},"0.0.1",{requires:["transition"]});
"use strict";YUI.add("rg-autocomplete",function(a){function b(a){a.inputNode=a.host,a.render||a.render===!1||(a.render=!0),b.superclass.constructor.apply(this,arguments)}a.namespace("rg.autocomplete");var c,d,e;!function(){c=a.Base.create("LoadingPlugin",a.Plugin.Base,[],{_queryHandle:null,_resultsHandle:null,_clearHandle:null,initializer:function(){var a=this.get("host"),b=a.get("inputNode"),c=this.get("loadingClassOn"),d=this.get("loadingClassOff");b.addClass(d),this._queryHandle=a.on("query",function(){b.removeClass(d),b.addClass(c)},this),this._resultsHandle=a.on("results",function(){b.removeClass(c),b.addClass(d)},this),this._clearHandle=a.on("clear",function(){b.removeClass(c),b.addClass(d)},this)},destructor:function(){this._queryHandle.detach(),this._resultsHandle.detach(),this._clearHandle.detach()}},{NS:"autocompleteLoadingPlugin",ATTRS:{loadingClassOn:{value:"ajax-loading"},loadingClassOff:{value:""}}})}(),function(){var b="_SELECTOR_ITEM",c="activeItem";e=a.Base.create("ChangeActiveOnHover",a.Plugin.Base,[],{initializer:function(){this.beforeHostMethod("_afterMouseOver",this._afterMouseOver,this.get("host")),this.beforeHostMethod("_afterMouseOut",this._afterMouseLeave,this.get("host"))},_afterMouseOver:function(a){var d=a.domEvent.target.ancestor(this[b],!0);d&&this._set(c,d)},_afterMouseLeave:function(){this._set(c,null)}},{NS:"changeActiveOnHover"})}(),function(){d=a.Base.create("aclist",a.AutoCompleteList,[],{initializer:function(){this.plug(e),this.plug(c,{loadingClassOn:"ac-ajax-loadingon",loadingClassOff:"ac-ajax-loadingoff"})}},{})}(),a.extend(b,d,{},{NAME:"autocompleteListPlugin",NS:"ac",CSS_PREFIX:a.ClassNameManager.getClassName("aclist")}),a.rg.autocomplete.LoadingPlugin=c,a.rg.autocomplete.ChangeActiveOnHover=e,a.rg.autocomplete.AutoComplete=d,a.rg.autocomplete.AutoCompletePlugin=b},"0.0.1",{requires:["autocomplete","autocomplete-list","autocomplete-highlighters","autocomplete-filters","node-pluginhost"]});
"use strict";YUI.add("rg.core.autocomplete.AlignNode",function(a){a.namespace("rg.core.autocomplete"),a.rg.core.autocomplete.AlignNode=a.Base.create("AlignNode",a.Plugin.Base,[],{initializer:function(){var b=this.get("host");return"autocompleteListPlugin"!=b.name?void a.log("Y.rg.core.autocomplete.AlignNode must be plugged on autocompleteListPlugin"):void this.align()},align:function(){var a=this.get("host");a.set("align",{node:this.get("node"),points:["tl","bl"]}),a.set("width",this.get("node").get("offsetWidth"))}},{NS:"AlignNode",ATTRS:{node:{value:null}}})},"0.0.1",{requires:[]});
"use strict";YUI.add("rg.core.autocomplete.ToggleLoadingState",function(a){a.namespace("rg.core.autocomplete"),a.rg.core.autocomplete.ToggleLoadingState=a.Base.create("ToggleLoadingState",a.Plugin.Base,[],{initializer:function(){var b=this.get("host");return"autocompleteListPlugin"!=b.name?void a.log("Y.rg.core.autocomplete.ToggleLoadingState must be plugged on autocompleteListPlugin"):(b.on("query",function(){this.toggleLoadingState(!0)},this),void b.on(["results","clear"],function(){this.toggleLoadingState(!1)},this))},toggleLoadingState:function(a){a?this.get("node").addClass(this.get("loadingClass")):this.get("node").removeClass(this.get("loadingClass"))}},{NS:"ToggleLoadingState",ATTRS:{node:{value:null},loadingClass:{value:"search-loading"}}})},"0.0.1",{requires:[]});
"use strict";YUI.add("rg.views.application.BrandHeaderView",function(a){a.namespace("rg.views.application"),a.rg.views.application.BrandHeaderView=a.Base.create("application.BrandHeaderView",a.rg.WidgetView,[],{events:{".js-filter-item":{click:"selectSearchFilter"},".js-invite-colleagues":{click:"showInviteDialog"},".js-add-institution":{click:"showAddInstitutionDialog"},global:{"AccountNominationInvite:invited":"onNomination"},".js-dropdown-toggle[aria-expanded]":{click:"dropdownToggled"},".js-log-out":{click:"onLogOut"}},afterRendered:function(){var b=this.get("container"),c=b.one(".js-search-input"),d=b.one(".js-search-wrapper");if(this.attachDropdowns(),this.get("openHeaderMenu")){var e=b.one(".notification-"+this.get("openHeaderMenu"));e&&e.one(".js-dropdown-toggle").simulate("click")}c&&(c.on("focus",function(){this._trackTypeSelectorUsage()},this),d&&(d.on("mouseenter",function(){b.addClass("searchhover")}),d.on("mouseleave",function(){b.removeClass("searchhover")}),d.on("focus",function(){b.addClass("searchactive"),b.removeClass("searchinactive")},this),d.on("blur",function(){b.removeClass("searchactive"),b.addClass("searchinactive")})),this._searchNode=c,this.initAutoComplete()),this.data.isUser&&(b.one(".notification-updates .notification-link").once("click",function(){a.rg.ajax("application.AjaxCommon.ajaxScoreGoal.html",{goal:this.data.goalUpdated})},this),b.one(".notification-messages .notification-link").once("click",function(){a.rg.ajax("application.AjaxCommon.ajaxScoreGoal.html",{goal:this.data.goalMessages})},this),b.one(".notification-requests .notification-link").once("click",function(){a.rg.ajax("application.AjaxCommon.ajaxScoreGoal.html",{goal:this.data.goalRequests})},this)),widgetLoader.loadAndRenderAsyncWidget(this.get("container").one(".js-delayed-alert-container"),{innerWidgetUrl:"application.DelayedAlert.html"})},attachDropdowns:function(){var b=this.get("container").all(".js-dropdown"),c=function(b,c){c&&c.preventDefault();var d=b.get("host");if(d.hasClass("notification-item")){var e=d.getData("seen-event");e&&a.fire(e);var f=d.one(".js-requests-container"),g=f.getData("was-rendered");if(f&&!g){var h=d.getData("content-url");widgetLoader.loadWidget(h,{},function(a){a.render({replaceContent:f}),f.setData("was-rendered",!0)})}}};b.plug(a.rg.plugin.DropdownPlugin,{ignoreInsideClick:!0,ignoreLinks:!0,activatorSelector:".js-dropdown-toggle",callbackOnOpen:c})},_trackTypeSelectorUsage:function(){a.rg.ajax(this.data.trackTypeUsageEndpoint,{type:this._selectedType},function(){},this,null,"POST")},selectSearchFilter:function(a){if(a&&a.currentTarget){var b=a.currentTarget.getData("ico"),c=a.currentTarget.getData("value"),d=a.currentTarget.getData("placeholder"),e=this.get("container");e.all(".search-filter .filter-item").removeClass("active"),a.currentTarget.ancestor(".filter-item").addClass("active"),e.one(".js-type-input").set("value",c),e.one(".js-search-input").set("placeholder",d),e.one(".js-search-ico").setAttribute("class","js-search-ico header-ico-combined "+b);var f=this.data.searchTypes[c];""==f.ajaxSource?this._searchNode.ac.set("minQueryLength",1e8):this._searchNode.ac.set("minQueryLength",this.get("minQueryLength")),this._searchNode.ac.set("source",f.ajaxSource),this._searchNode.ac.clearCache()}this._searchNode.focus()},initAutoComplete:function(){var b=widgetRenderer.getStub("application/stubs/partials/headerSearchResultItem.html"),c=widgetRenderer.getStub("application/stubs/partials/headerSearchMore.html"),d=widgetRenderer.createHoganTemplate(b.compiledTemplate,b.templateString),e=widgetRenderer.createHoganTemplate(c.compiledTemplate,c.templateString),f=function(b,c){return a.Array.map(c,function(a){var b=a.raw,c=a.highlighted?a.highlighted:a.display;return d.render({highlighted:"<noscript></noscript>"+c,text:a.text,img_url:b.image,additional:b.institution})})},g=this.data.searchResultsHighlighted?"phraseMatch":null;this._searchNode.plug(a.Plugin.AutoComplete,{resultFormatter:f,resultHighlighter:g,resultListLocator:"result",resultTextLocator:"name",queryDelay:200,minQueryLength:2,maxResults:16,activateFirstItem:!1,render:!0,align:{node:this.get("container").one(".js-search-wrapper"),points:["tr","br"]},width:420,plugins:[a.rg.autocomplete.ChangeActiveOnHover,{fn:a.rg.core.autocomplete.ToggleLoadingState,cfg:{node:this.get("container").one(".js-search-wrapper"),loadingClass:"search-loading"}}],source:this.data.defaultType.ajaxSource}),this._searchNode.ac.on("select",this.selectItem,this);var h=this._searchNode.ac.get("contentBox"),i=a.Node.create('<div class="dropdown-title js-dropdown-title"></div>');i.set("text",this.data.defaultType.label),h.insert(i,0),h.append('<div class="view-all-btn"></div>'),this._searchNode.ac.on("results",function(a){var b=e.render({text:a.query,viewId:this.data.viewId});h.one(".view-all-btn").setContent(b)},this)},selectItem:function(b){a.rg.utils.url.forwardTo(b.result.raw.url)},showInviteDialog:function(){var a;a=this.get("remainingNominations")<=0?this.get("inviteDialogUrl"):this.get("nominateDialogUrl"),widgetLoader.loadWidgetInDialog(a)},showAddInstitutionDialog:function(){widgetLoader.loadWidgetInDialog("account.AddInstitutionDialog.html",{account_key:this.data.accountKey})},onNomination:function(a){this.set("remainingNominations",a.count)},dropdownToggled:function(a){var b=a.currentTarget._node;b.setAttribute("aria-expanded","false"===b.getAttribute("aria-expanded")?"true":"false")},onLogOut:function(){a.fire("BrandHeader:logOut")}},{ATTRS:{minQueryLength:{value:2},remainingNominations:{},nominateDialogUrl:{},inviteDialogUrl:{},openHeaderMenu:{}}})},"1.0.0",{requires:["rg-dropdown-plugin","rg-autocomplete","rg.core.autocomplete.AlignNode","rg.core.autocomplete.ToggleLoadingState","application/stubs/partials/headerSearchMore.html","application/stubs/partials/headerSearchResultItem.html","node-event-simulate"]});
